# Migration `20201109002900-init`

This migration has been generated by Kalle (Sendou) at 11/9/2020, 2:29:00 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Ability" AS ENUM ('CB', 'LDE', 'OG', 'T', 'H', 'NS', 'TI', 'RP', 'AD', 'DR', 'SJ', 'OS', 'BDU', 'REC', 'RES', 'ISM', 'ISS', 'MPU', 'QR', 'QSJ', 'RSU', 'SSU', 'SCU', 'SPU', 'SS', 'BRU')

CREATE TABLE "public"."Build" (
"id" SERIAL,
"userId" integer   NOT NULL ,
"weapon" text   NOT NULL ,
"title" text   ,
"description" text   ,
"mainAbilities" "Ability"[]  ,
"subAbilities" "Ability"[]  ,
"abilityPoints" jsonb   NOT NULL ,
"headGear" text   ,
"clothingGear" text   ,
"shoesGear" text   ,
"top500" boolean   NOT NULL ,
"jpn" boolean   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE INDEX "Build.weapon_index" ON "public"."Build"("weapon")

CREATE INDEX "Build.userId_index" ON "public"."Build"("userId")

CREATE INDEX "Build.abilityPoints_index" ON "public"."Build"("abilityPoints")

ALTER TABLE "public"."Build" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201103144752-init..20201109002900-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,8 +1,8 @@
 datasource db {
   provider = "postgresql"
   // FIXME: should use same .env system as Next.JS
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -15,8 +15,9 @@
   discordId     String   @unique
   discordAvatar String?
   profile       Profile?
   player        Player?
+  Build         Build[]
 }
 model Profile {
   twitterName   String?
@@ -56,9 +57,59 @@
 }
 model Player {
   switchAccountId String           @unique
-  user            User?            @relation(fields: [userId], references: [id])
   userId          Int?             @unique
   name            String
   placements      XRankPlacement[]
+  user            User?            @relation(fields: [userId], references: [id])
 }
+
+enum Ability {
+  CB
+  LDE
+  OG
+  T
+  H
+  NS
+  TI
+  RP
+  AD
+  DR
+  SJ
+  OS
+  BDU
+  REC
+  RES
+  ISM
+  ISS
+  MPU
+  QR
+  QSJ
+  RSU
+  SSU
+  SCU
+  SPU
+  SS
+  BRU
+}
+
+model Build {
+  id            Int       @id @default(autoincrement())
+  userId        Int
+  weapon        String
+  title         String?
+  description   String?
+  mainAbilities Ability[]
+  subAbilities  Ability[]
+  abilityPoints Json
+  headGear      String?
+  clothingGear  String?
+  shoesGear     String?
+  top500        Boolean
+  jpn           Boolean
+  user          User      @relation(fields: [userId], references: [id])
+
+  @@index(weapon)
+  @@index(userId)
+  @@index(abilityPoints)
+}
```


