# Migration `20201028083612-init`

This migration has been generated by Kalle (Sendou) at 10/28/2020, 10:36:12 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"id" SERIAL,
"username" text   NOT NULL ,
"discriminator" text   NOT NULL ,
"discordId" text   NOT NULL ,
"discordAvatar" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Profile" (
"twitterName" text   ,
"twitchName" text   ,
"youtubeId" text   ,
"country" text   ,
"sensMotion" Decimal(65,30)   ,
"sensStick" Decimal(65,30)   ,
"bio" text   ,
"weaponPool" text []  ,
"customUrlPath" text   ,
"userId" integer   NOT NULL 
)

CREATE TABLE "public"."XRankPlacement" (
"id" SERIAL,
"playerId" text   NOT NULL ,
"playerName" text   NOT NULL ,
"playerNameLower" text   NOT NULL ,
"ranking" integer   NOT NULL ,
"xPower" Decimal(65,30)   NOT NULL ,
"weapon" text   NOT NULL ,
"mode" "RankedMode"  NOT NULL ,
"month" integer   NOT NULL ,
"year" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Player" (
"playerId" text   NOT NULL ,
"userId" integer   ,
"names" text []  
)

CREATE UNIQUE INDEX "User.discordId_unique" ON "public"."User"("discordId")

CREATE UNIQUE INDEX "Profile.customUrlPath_unique" ON "public"."Profile"("customUrlPath")

CREATE UNIQUE INDEX "Profile.userId_unique" ON "public"."Profile"("userId")

CREATE UNIQUE INDEX "XRankPlacement.playerId_mode_month_year_unique" ON "public"."XRankPlacement"("playerId", "mode", "month", "year")

CREATE INDEX "XRankPlacement.playerNameLower_index" ON "public"."XRankPlacement"("playerNameLower")

CREATE UNIQUE INDEX "Player.playerId_unique" ON "public"."Player"("playerId")

CREATE UNIQUE INDEX "Player.userId_unique" ON "public"."Player"("userId")

ALTER TABLE "public"."Profile" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."XRankPlacement" ADD FOREIGN KEY("playerId")REFERENCES "public"."Player"("playerId") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Player" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201028083612-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,66 @@
+datasource db {
+  provider = "postgresql"
+  // FIXME: should use same .env system as Next.JS
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id            Int      @id @default(autoincrement())
+  username      String
+  discriminator String
+  discordId     String   @unique
+  discordAvatar String?
+  profile       Profile?
+  player        Player?
+}
+
+model Profile {
+  twitterName   String?
+  twitchName    String?
+  youtubeId     String?
+  country       String?
+  sensMotion    Float?
+  sensStick     Float?
+  bio           String?
+  weaponPool    String[]
+  customUrlPath String?  @unique
+  user          User     @relation(fields: [userId], references: [id])
+  userId        Int      @unique
+
+}
+
+enum RankedMode {
+  SZ
+  TC
+  RM
+  CB
+}
+
+model XRankPlacement {
+  id              Int        @id @default(autoincrement())
+  playerId        String
+  player          Player     @relation(fields: [playerId], references: [playerId])
+  playerName      String
+  playerNameLower String
+  ranking         Int
+  xPower          Float
+  weapon          String
+  mode            RankedMode
+  month           Int
+  year            Int
+
+  @@unique([playerId, mode, month, year])
+  @@index([playerNameLower])
+}
+
+model Player {
+  playerId   String           @unique
+  user       User?            @relation(fields: [userId], references: [id])
+  userId     Int?             @unique
+  names      String[]
+  placements XRankPlacement[]
+}
```


